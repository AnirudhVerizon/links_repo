{
  "Page": {
    "pageType": "globalSearchTypeahead",
    "template": "globalSearchList",
    "header": {
      "moleculeName": "header",
      "topPadding": 12,
      "bottomPadding": 12,
      "molecule": {
        "moleculeName": "stack",
        "spacing": 12,
        "axis": "horizontal",
        "molecules": [
          {
            "moleculeName": "stackItem",
            "molecule": {
              "moleculeName": "imageButton",
              "image": {
                "moleculeName": "image",
                "image": "bot_header",
                "width": 16,
                "height": 16
              },
              "action": {
                "actionType": "openPanel",
                "extraParameters": {
                  "chatbotSourceType": "hab"
                },
                "panel": "right"
              }
            }
          },
          {
            "moleculeName": "stackItem",
            "molecule": {
              "moleculeName": "link",
              "action": {
                "actionType": "openPanel",
                "extraParameters": {
                  "chatbotSourceType": "hab"
                },
                "panel": "right"
              },
              "title": "Chat with us"
            }
          }
        ]
      }
    },
    "sections": [
      {
        "header": {
          "topPadding": 0,
          "bottomPadding": 12,
          "moleculeName": "sectionHeader",
          "molecule": {
            "moleculeName": "label",
            "fontStyle": "BoldBodyLarge",
            "text": "Search Suggestions"
          }
        },
        "rows": [
          {
            "topPadding": 12,
            "moleculeName": "searchHighlightLabel",
            "text": "iPhone",
            "fontStyle": "RegularBodyLarge",
            "line": {
              "type": "none"
            },
            "action": {
              "actionType": "actions",
              "actions": [
                {
                  "extraParameters": {
                    "browserUrl": "https://www.verizon.com/onesearch/search?q=Apple&lid=sayt&sayt=iphone*&src=wireless&source=MFNative",
                    "screenHeading": "Search"
                  },
                  "actionType": "openPage",
                  "appContext": "mobile/nsa/nos/gw/launchapp/l2",
                  "pageType": "webview"
                },
                {
                  "actionType": "saveSearchHistory",
                  "action": "save",
                  "extraParameters": {
                    "searchInput": "iPhone"
                  }
                }
              ]
            },
            "bottomPadding": 12,
            "accessibilityText": "iPhone",
            "hideArrow": true
          },
          {
            "topPadding": 12,
            "moleculeName": "searchHighlightLabel",
            "text": "iPhone 16",
            "fontStyle": "RegularBodyLarge",
            "line": {
              "type": "none"
            },
            "action": {
              "actionType": "actions",
              "actions": [
                {
                  "extraParameters": {
                    "browserUrl": "https://www.verizon.com/onesearch/search?q=Apple&lid=sayt&sayt=iphone16*&src=wireless&source=MFNative",
                    "screenHeading": "Search"
                  },
                  "actionType": "openPage",
                  "appContext": "mobile/nsa/nos/gw/launchapp/l2",
                  "pageType": "webview"
                },
                {
                  "actionType": "saveSearchHistory",
                  "action": "save",
                  "extraParameters": {
                    "searchInput": "iPhone 16"
                  }
                }
              ]
            },
            "bottomPadding": 12,
            "accessibilityText": "iPhone 16",
            "hideArrow": true
          },
          {
            "topPadding": 12,
            "moleculeName": "searchHighlightLabel",
            "text": "iPhone 16 Pro",
            "fontStyle": "RegularBodyLarge",
            "line": {
              "type": "none"
            },
            "action": {
              "actionType": "actions",
              "actions": [
                {
                  "extraParameters": {
                    "browserUrl": "https://www.verizon.com/onesearch/search?q=Apple&lid=sayt&sayt=iphone16pro*&src=wireless&source=MFNative",
                    "screenHeading": "Search"
                  },
                  "actionType": "openPage",
                  "appContext": "mobile/nsa/nos/gw/launchapp/l2",
                  "pageType": "webview"
                },
                {
                  "actionType": "saveSearchHistory",
                  "action": "save",
                  "extraParameters": {
                    "searchInput": "iPhone 16 pro"
                  }
                }
              ]
            },
            "bottomPadding": 12,
            "accessibilityText": "iPhone 16 Pro",
            "hideArrow": true
          }
        ]
      }
    ]
  }
}


    private fun searchTextFlow(): Flow<String> = callbackFlow {
        val watcher = object : TextWatcher {
            override fun beforeTextChanged(s: CharSequence?, start: Int, count: Int, after: Int) {}
            override fun onTextChanged(s: CharSequence?, start: Int, before: Int, count: Int) {
                trySend(s.toString()).isSuccess
            }

            override fun afterTextChanged(s: Editable?) {}
        }
        searchResultsView?.addTextChangedListener(watcher)
        awaitClose { searchResultsView?.removeTextChangedListener(watcher) }
    }

    private fun observerSearch() {
        searchTextFlow().debounce(200).filter {
            if (it.isEmpty() && isSearchActive) {
                onSearchListener?.showOrHideOverlay(
                    true,
                    globalSearchListTemplateModel = initialSearchTemplate()
                )
            }
            it.isNotEmpty() && isSearchActive
        }.distinctUntilChanged().onEach { query -> performApiCall(query) }.launchIn(scope)
    }









